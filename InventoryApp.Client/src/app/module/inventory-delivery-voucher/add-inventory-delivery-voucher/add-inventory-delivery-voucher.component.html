<app-page-title title={{Title}} [pageTitle]="pageTite"></app-page-title>
<form [formGroup]="addInventoryDeliveryVoucherForm" (ngSubmit)="addInventoryDeliveryoucher()">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mb-4">Form thông tin phiếu xuất hàng cơ bản</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3"
                                    (click)="refreshBranchData()" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Chi nhánh<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="branchList"
                                        (valueChanged)="changeBranchValue($event)"></ng-select2>
                                    <input type="text" class="specialInput" formControlName="branchId"
                                        id="branchId">
                                </div>
                            </div>
                            <div class="form-group specialFormGroup">
                                <label for="categoryMaterial">Kho hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="warehouseList" (valueChanged)="changWarehouseValue($event)"></ng-select2>
                                   
                                    <input type="text" class="specialInput" formControlName="warehouseId"
                                        id="warehouseId">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Đơn đặt hàng của khách hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" (valueChanged)="changeOrderValue($event)"
                                        [data]="orderList"></ng-select2>
                                   
                                    <input type="text" class="specialInput" formControlName="orderId"
                                        id="orderId">
                                </div>
                            </div>
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Nhân viên xuất kho<span
                                        class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="userList" (valueChanged)="changeUserValue($event)"></ng-select2>
                                  
                                    <input type="text" class="specialInput" formControlName="userDeliveryId"
                                        id="userDeliveryId">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-6">
                                <div class="avatar-md bg-info rounded-circle">
                                    <i class="ion-logo-usd avatar-title font-26 text-white"></i>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-right">
                                    <h3 class="my-0 font-weight-bold"><span data-plugin="counterup">
                                            <div>{{ totalSale| currency:'VND':'symbol' }}</div>
                                        </span></h3>
                                    <p class="mb-0 mt-1 text-truncate">Tổng số tiền</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-6">
                                <div class="avatar-md bg-warning rounded-circle">
                                    <i class="ion-md-cart avatar-title font-26 text-white"></i>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-right">
                                    <h3 class="my-0 font-weight-bold"><span
                                            data-plugin="counterup">{{totalMaterial}}</span></h3>
                                    <p class="mb-0 text-truncate">Tổng sản phẩm xuất kho</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <form [formGroup]="addInventoryDeliveryVoucherDetailForm" (ngSubmit)="addInventoryDeliveryVoucherDetail()">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title mb-4">Chọn sản phẩm tương ứng</h4>
                        <div style="display:flex;column-gap: 20px;align-items: center;">
                            <div class="specialFormGroup inputOrderDetail" style="width: 380px;">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Sản phẩm<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="materialList" (valueChanged)="changMaterialValue($event)"></ng-select2>
                                    <input type="text" class="specialInput" formControlName="materialId" id="materialId">
                                </div>
                            </div>
                            <div class="specialFormGroup inputOrderDetail"  style="width: 460px;">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="shipmentId">Lô hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="shipmentList" (valueChanged)="changShipmentValue($event)"></ng-select2>
                                    <input type="text" class="specialInput" formControlName="shipmentId" id="shipmentId">
                                </div>
                            </div>
                            <div class="specialFormGroup" style="position: relative;top:1px">
                                <label for="name">Số lượng xuất<span class="text-danger">*</span></label>
                                <input type="number" name="nick" parsley-trigger="change"
                                    formControlName="quantityDelivery" class="form-control" id="name">
                                <input type="text" min="0" class="specialInput" id="quantityDelivery">
                            </div>
                            <div class="specialFormGroup" style="position:relative;top:4px;">
                                <button type="submit" [disabled]="!addInventoryDeliveryVoucherDetailForm.valid"
                                    class="btn btn-primary waves-effect waves-light mr-1">
                                    <i class="fa fa-plus-circle"></i> Thêm <span class=""></span>
                                </button>
                            </div>
                        </div>
                            <div class="specialFormGroup inputOrderDetail"
                                style="position: relative;top:1px;width: 380px;">
                                <label for="name">Số lượng đặt hàng<span class="text-danger">*</span></label>
                                <input type="number" name="nick" parsley-trigger="change" readonly value="{{quantity}}"
                                    class="form-control" id="name">
                                <input type="text" class="specialInput" id="quantityRequest">
                            </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body table-responsive">
                    <h4 class="m-t-0 header-title mb-4">
                        <b>Chi tiết phiếu xuất kho</b>
                        <span style="padding-left: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                            <i class="icon-refresh" style="font-weight: 500;"></i>
                        </span>
                    </h4>
                    <span (click)="onRemoveSelected()" class="btn btn-sm btn-danger waves-effect waves-light mr-1">
                        Xóa sản phẩm <span class=""></span>
                    </span>
                    <ag-grid-angular style="width: 100%;height: 500px;" class="ag-theme-alpine mt-1" [rowData]="dataRow"
                        [defaultColDef]="defaultColDef" [columnDefs]="columnDefs" [alwaysShowHorizontalScroll]="true"
                        [alwaysShowVerticalScroll]="true" [gridOptions]="gridOptions" [rowSelection]="rowSelection"
                        [paginationPageSize]="sizePagination" (gridReady)="onGridReady($event)">
                    </ag-grid-angular>
                </div>
            </div>
        </div>
    </div>
    <input type="text" class="specialInput" formControlName="details" id="details">
    <div style="margin-bottom: 20px;">
        <button type="submit" [disabled]="!addInventoryDeliveryVoucherForm.valid" class="btn btn-primary waves-effect waves-light mr-1">
            Lưu dữ liệu <span class="" [ngClass]="submitData ? 'spinner-border spinner-border-sm' : ''"></span>
        </button>
        <button type="reset" class="btn btn-secondary waves-effect waves-light">
            Cancel
        </button>
    </div>
</form>
<div *ngIf="submitData || loadData" class="containerLoader">
    <div class="loader"></div>
</div>