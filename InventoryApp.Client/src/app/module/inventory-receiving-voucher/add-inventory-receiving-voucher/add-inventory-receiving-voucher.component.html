<app-page-title title={{Title}} [pageTitle]="pageTite"></app-page-title>
<form [formGroup]="addOrderForm" (ngSubmit)="addOrder()">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mb-4">From thông tin phiếu nhập hàng cơ bản</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3"
                                    (click)="refreshBranchData()" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Chi nhánh<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="branchList"
                                        (valueChanged)="changeBranchValue($event)"></ng-select2>
                                    <div class="feedback"
                                        *ngIf="branchRequestId?.errors?.['required'] && (branchRequestId?.touched)">Chọn
                                        nhà cung cấp</div>
                                    <input type="text" class="specialInput" formControlName="branchRequestId"
                                        id="branchRequestId">
                                </div>
                            </div>
                            <div class="form-group specialFormGroup">
                                <label for="categoryMaterial">Kho hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="warehouseList"></ng-select2>
                                    <div class="feedback"
                                        *ngIf="supplierId?.errors?.['required'] && (supplierId?.touched)">Chọn chi nhánh
                                    </div>
                                    <input type="text" class="specialInput" formControlName="supplierId"
                                        id="supplierId">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Đơn đặt hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" (valueChanged)="changeOrderValue($event)"
                                        [data]="orderList"></ng-select2>
                                    <div class="feedback"
                                        *ngIf="supplierId?.errors?.['required'] && (supplierId?.touched)">Chọn chi nhánh
                                    </div>
                                    <input type="text" class="specialInput" formControlName="supplierId"
                                        id="supplierId">
                                </div>
                            </div>
                            <div class="form-group specialFormGroup">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Nhân viên nhập kho<span
                                        class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="userList"></ng-select2>
                                    <div class="feedback"
                                        *ngIf="supplierId?.errors?.['required'] && (supplierId?.touched)">Chọn chi nhánh
                                    </div>
                                    <input type="text" class="specialInput" formControlName="supplierId"
                                        id="supplierId">
                                </div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-4">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-6">
                                <div class="avatar-md bg-info rounded-circle">
                                    <i class="ion-logo-usd avatar-title font-26 text-white"></i>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-right">
                                    <h3 class="my-0 font-weight-bold"><span data-plugin="counterup">
                                            <div>{{ totalSale| currency:'VND':'symbol' }}</div>
                                        </span></h3>
                                    <p class="mb-0 mt-1 text-truncate">Tổng số tiền</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-6">
                                <div class="avatar-md bg-warning rounded-circle">
                                    <i class="ion-md-cart avatar-title font-26 text-white"></i>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-right">
                                    <h3 class="my-0 font-weight-bold"><span
                                            data-plugin="counterup">{{totalMaterial}}</span></h3>
                                    <p class="mb-0 text-truncate">Tổng sản phẩm nhập kho</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-6">
                                <div class="avatar-md bg-danger rounded-circle">
                                    <i class="ion ion-md-close-circle avatar-title font-26 text-white"></i>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-right">
                                    <h3 class="my-0 font-weight-bold"><span
                                            data-plugin="counterup">{{totalMaterial}}</span></h3>
                                    <p class="mb-0 mt-1 text-truncate">Tổng sản phẩm lỗi</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

    </div>
    <div class="row">
        <div class="col-lg-12">
            <form [formGroup]="addOrderDetailForm" (ngSubmit)="addOrderDetail()">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title mb-4">Chọn sản phẩm tương ứng</h4>
                        <div style="display:flex;column-gap: 20px;align-items: center;">
                            <div class="specialFormGroup inputOrderDetail" style="width: 380px;">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Sản phẩm<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="materialList"
                                        (valueChanged)="changMaterialValue($event)"></ng-select2>
                                    <input type="text" class="specialInput" formControlName="materialId"
                                        id="materialId">
                                </div>
                            </div>
                            <div class="specialFormGroup inputOrderDetail">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3"
                                    (click)="openModalAddShipment()" class="btnAdd">
                                    <i class="fa fa-plus-circle"></i>
                                </span>
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="shipmentId">Lô hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true" [data]="shipmentList"></ng-select2>
                                    <input type="text" class="specialInput" id="shipmentId">
                                </div>
                            </div>
                            <div class="specialFormGroup" style="position:relative;top:4px;">
                                <button type="submit" [disabled]="!addOrderDetailForm.valid"
                                    class="btn btn-primary waves-effect waves-light mr-1">
                                    <i class="fa fa-plus-circle"></i> Thêm <span class=""></span>
                                </button>
                            </div>
                        </div>
                        <div style="display:flex;column-gap: 20px;align-items: center;">
                            <div class="specialFormGroup inputOrderDetail"
                                style="position: relative;top:1px;width: 380px;">
                                <label for="name">Số lượng đặt hàng<span class="text-danger">*</span></label>
                                <input type="number" name="nick" parsley-trigger="change" readonly value="{{quantity}}"
                                    class="form-control" id="name">
                                <input type="text" class="specialInput" id="quantityRequest">
                            </div>
                            <div class="specialFormGroup inputOrderDetail" style="position: relative;top:1px">
                                <label for="name">Số lượng nhập<span class="text-danger">*</span></label>
                                <input type="number" name="nick" parsley-trigger="change"
                                    formControlName="quantityRequest" class="form-control" id="name">
                                <input type="text" class="specialInput" id="quantityRequest">
                            </div>
                            <div class="specialFormGroup inputOrderDetail" style="position: relative;top:1px">
                                <label for="name">Số lượng hàng hư tổn<span class="text-danger">*</span></label>
                                <input type="number" name="nick" parsley-trigger="change"
                                    formControlName="quantityRequest" class="form-control" id="name">
                                <input type="text" class="specialInput" id="quantityRequest">
                            </div>

                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title mb-4">Vị trí sản phẩm</h4>
                        <div style="display:flex;column-gap: 20px;align-items: center;">
                            <div class="specialFormGroup inputOrderDetail" style="width: 380px;">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3;" class="btnAdd">
                                    <i class="fa fa-plus-circle"></i>
                                </span>
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Khu vực kho<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true"></ng-select2>
                                    <input type="text" class="specialInput" id="categoryMaterialId">
                                </div>
                            </div>
                            <div class="specialFormGroup inputOrderDetail">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="fa fa-plus-circle"></i>
                                </span>
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Hàng<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true"></ng-select2>
                                    <input type="text" class="specialInput" id="categoryMaterialId">
                                </div>
                            </div>
                            <div class="specialFormGroup inputOrderDetail">
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="fa fa-plus-circle"></i>
                                </span>
                                <span style="padding-right: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                                    <i class="icon-refresh" style="font-weight: 500;"></i>
                                </span>
                                <label for="categoryMaterial">Kệ<span class="text-danger">*</span></label>
                                <div>
                                    <ng-select2 aria-required="true"></ng-select2>
                                    <input type="text" class="specialInput" id="categoryMaterialId">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body table-responsive">
                    <h4 class="m-t-0 header-title mb-4">
                        <b>Chi tiết đơn đặt hàng</b>
                        <span style="padding-left: 5px;font-size: 16px;color:#3bc0c3" class="btnAdd">
                            <i class="icon-refresh" style="font-weight: 500;"></i>
                        </span>
                    </h4>
                    <span (click)="onRemoveSelected()" class="btn btn-sm btn-danger waves-effect waves-light mr-1">
                        Xóa sản phẩm <span class=""></span>
                    </span>
                    <ag-grid-angular style="width: 100%;height: 500px;" class="ag-theme-alpine mt-1" [rowData]="dataRow"
                        [defaultColDef]="defaultColDef" [columnDefs]="columnDefs" [alwaysShowHorizontalScroll]="true"
                        [alwaysShowVerticalScroll]="true" [gridOptions]="gridOptions" [rowSelection]="rowSelection"
                        [paginationPageSize]="sizePagination" (gridReady)="onGridReady($event)">
                    </ag-grid-angular>
                </div>
            </div>
        </div>
    </div>
    <input type="text" class="specialInput" formControlName="supplierOrderDetail" id="supplierOrderDetail">
    <div style="margin-bottom: 20px;">
        <button type="submit" [disabled]="!addOrderForm.valid" class="btn btn-primary waves-effect waves-light mr-1">
            Lưu dữ liệu <span class="" [ngClass]="submitData ? 'spinner-border spinner-border-sm' : ''"></span>
        </button>
        <button type="reset" class="btn btn-secondary waves-effect waves-light">
            Cancel
        </button>
    </div>
</form>
<div *ngIf="submitData || loadData" class="containerLoader">
    <div class="loader"></div>
</div>